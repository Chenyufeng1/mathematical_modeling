%=======================================================
%                   BP神经网络训练源码
%               参赛人员：江荣、刘强、刘权
%=======================================================
%附录A中的样本数据
A=[45216	10	122	263	2078	1568	2006	4.06792	78849.1	512418	390413	1531.5	1818	9	0.948631	545	0.444832	1.2319	44.0934	42.9974;
28577.6	13	171	367	1994	1887	2074.9	3.75695	103228	676400	530778	1617.49	1734.79	9	0.947193	717	0.480742	1.07896	43.533	44.3678;
30403.2	12	175	373	2065	1824	2079	2.90775	113502	499671	283360	1587.72	1880.77	11	0.942836	753	0.444403	1.06093	51.7272	52.2666;
37443.4	8	181	377	2066	2049	1926	2.48711	117029	543917	275067	1677.39	2167.61	9	0.922526	835	0.422956	1.18462	53.941	54.8796;
33571.5	11	150	321	2049	1499	1901	2.63934	96039.8	548245	439406	1588.52	1822.94	9	0.92836	1251	0.506922	1.00162	53.8477	51.5732;
0	0	524	1049	1588.14	1894.48	1903.06	0.917073	113029	323142	87392	1524.17	1664.38	25	0.997251	4537	0.51538	3.51806	33.1722	33.3961;
0	1	471	944	236	257	32	1.406	10890.1	50877	27291.9	307.939	378.739	29	0.963051	2060	0.5057	1.55768	79.2339	68.1593;
0	1	419	840	247.5	217	23	1.21598	8413.2	34666.2	19128.8	271.881	333.539	24	0.958375	1517	0.496086	1.41544	80.9247	74.1481;
0	1	416	835	234.5	216.5	21.5	1.59443	8144.81	42520	22380.8	252.846	327.466	25	0.967152	1376	0.488379	1.76195	78.3686	72.6174;
799.425	1	369	740	145.5	157.1	2.75	0.490901	4980.15	8336.16	1742.46	171.109	204.889	26	0.942692	5026	0.521856	1.66401	88.7641	77.2438;
989.742	2	357	717	114.22	162.3	6.75	0.531422	5497.91	9805.41	2032.62	170.473	188.862	24	0.931764	5715	0.533019	1.70924	82.3916	68.4736;
921.607	1	342	686	166.44	168.24	19.5	1.24022	5905.34	23086.4	7776.34	205.626	240.639	24	0.934016	2583	0.53154	1.94058	73.5552	63.7425;
606.854	7	54	121	334	656.5	362.5	0.58647	9670.48	16424.5	4231.31	615.681	802.95	8	0.826582	1443	0.451068	1.32993	63.4724	44.1926;
547.611	8	69	153	294	711	224.5	0.726351	14286.7	30090.5	8467.29	580.298	1065.03	10	0.848635	2152	0.522529	1.42865	63.9015	41.762;
676.862	8	97	209	343.5	520.5	333	0.508661	21315.2	30961.3	5816.42	1030.73	1803.5	13	0.794206	2729	0.509013	1.37076	69.1354	53.3115;
876.254	6	68	147	244.5	620.5	176	0.614993	10703.8	18874.2	5683.53	497.414	593.159	8	0.889963	1378	0.437302	1.3152	57.01	35.8608;
1052.17	6	64	139	288	789.5	382.5	0.554243	14561.5	23168.5	5997.81	648.622	859.232	11	0.846539	1734	0.51166	1.32056	65.0399	44.1257;
913.81	6	59	129	263	619	158	0.570834	10032.3	16283	3282.03	537.782	591.15	8	0.895918	1262	0.414744	1.53141	50.4272	34.3174;
405.358	2	70	143	371.17	1124.77	128.08	0.410709	7821.64	9352.12	994.507	843.425	977.263	12	0.882931	1087	0.532164	1.97009	83.4206	82.7332;
525.285	5	69	147	183.95	996	96.87	0.427228	7022.5	8055.66	943.759	786.296	941.583	19	0.818951	1708	0.601246	1.81089	78.0843	68.5211;
770.236	3	103	211	194.29	728.15	99.24	0.619625	7029.08	12354.4	2708.31	847.74	946.891	23	0.865758	2222	0.643824	1.8942	85.6212	77.6007;
1077.46	3	86	177	273.11	940.35	248.94	0.484806	11052.3	14989.3	2160.99	788.853	951.97	15	0.86029	1953	0.527784	1.80122	88.8427	84.0903;
573.453	3	23	51	44.4	844.6	83.9	0.514678	2425.23	3320.42	475.793	768.864	873.569	9	0.885245	487	0.587866	1.71934	73.3643	59.7938;
1030.8	3	3	11	177.64	349.67	15.87	2.05649	1129.06	7042.24	3509.48	376.023	398.353	1	0.920705	279	0.1	1.40456	42.9157	27.3235;
2621.58	3	3	11	50.02	225.19	50.45	2.10643	457.462	2650.23	1234.04	187.909	233.935	1	0.899617	158	0.1	1.43775	69.7255	69.4441;
1108.93	4	18	43	435.76	133.84	42.66	2.12334	1921.1	12525.3	6813.11	283.079	303.238	6	0.905413	781	0.638095	1.67694	59.8472	49.5949;
621.293	3	4	13	224.32	11.37	30.21	1.45414	516.794	2175.57	728.815	130.003	141.845	2	0.896773	133	0.322222	1.61176	75.4184	51.2385;
1126.36	3	9	23	242.72	272.04	9.97	1.43909	1167.58	5065.24	1759.49	214.042	238.146	3	0.953012	521	0.320779	1.66388	52.8385	52.0009;
1182.24	8	16	47	192.54	194.4	27.37	1.68041	1680.68	7944.11	3024.03	155.255	181.139	5	0.916929	503	0.48235	1.68824	45.1672	38.1585;
341.166	4	1	9	36.8	23.09	0	1.72381	98.5305	414.787	138.954	24.4021	27.8714	1	0.923354	14	0.333333	1.04609	33.8341	30.9658;
1064.35	6	16	43	218.8	197.42	59.45	1.62116	1856.4	8849.93	3465.98	265.286	287.741	4	0.89731	727	0.425842	1.59367	54.4791	42.6542;
1085.55	3	20	45	178.98	175.33	21.43	1.92123	1922.48	11354	5380.99	224.882	264.161	6	0.8809	957	0.433622	1.86605	84.4292	54.9849;
1507.27	7	1	15	73.77	115.44	37.94	2.11135	420.183	1768.86	592.568	74.0135	103.253	1	0.84324	21	0.857143	1.01513	7.00312	7.04344;
2160.66	8	14	43	476.24	217.83	19.81	1.69292	2038.97	9639.89	3839.35	422.062	458.043	3	0.909892	738	0.458297	1.48555	51.9848	45.2575;
2627.35	8	5	25	108.9	137.86	19.09	1.95498	681.233	2867.81	960.717	127.892	152.882	2	0.859438	119	0.560714	1.36998	31.4544	30.11;
810.485	6	25	61	247.94	217.87	37.75	2.21982	2582.47	17389.8	9448.43	324.132	432.329	6	0.880166	1149	0.483781	1.80633	69.2883	50.3214;
1408.23	5	10	29	128.47	288.1	36.42	1.77064	1751.79	9349.76	4010.11	239.369	273.591	3	0.875523	715	0.281685	1.62271	44.1068	32.8683;
0	0	12	25	131.08	183.5	59.98	1.5862	506.904	2416.5	990.476	197.908	286.167	9	0.896815	161	0.693182	2.35839	83.1304	90.841;
0	0	5	11	70.49	47.32	60.2	2.03244	157.941	1094.93	756.662	73.4004	80.8815	4	0.967473	33	0.466667	0.859888	83.46	81.4398;
0	0	8	17	152.57	151.32	80.62	1.05963	421.109	1815.56	898.499	176.946	260.963	7	0.886912	160	0.708333	1.29822	89.6869	76.995;
0	0	29	59	118.73	167	119.65	1.48574	1182.91	5914.92	2990.74	209.999	323.045	11	0.762898	463	0.502458	1.83239	84.949	79.6292;
0	0	19	39	127.8	175	138.99	1.52801	931.499	4487.96	1968.68	213.076	294.284	8	0.849923	311	0.474854	1.42343	88.977	95.4355;
0	0	4	9	64.82	120.64	59.66	1.082	285.773	1025.69	350.502	88.6748	127.273	3	0.885849	72	0.333333	1.10672	126.089	109.719;
];
%附录A中样本数据的期望分类
A_T=[
   0 0 1;0 0 1;0 0 1;0 0 1;0 0 1;0 0 1;
   0 1 0;0 1 0;0 1 0;0 1 0;0 1 0;0 1 0;
   0 1 1;0 1 1;0 1 1;0 1 1;0 1 1;0 1 1;
   1 0 0;1 0 0;1 0 0;1 0 0;1 0 0;
   1 0 1;1 0 1;1 0 1;1 0 1;1 0 1;
   1 1 0;1 1 0;1 1 0;1 1 0;1 1 0;1 1 0;1 1 0;1 1 0;1 1 0;
   1 1 1;1 1 1;1 1 1;1 1 1;1 1 1;1 1 1;
];
%附录C中的样本数据
C=[
29910.9	15	151	331	2541	1922	2077	3.80034	107519	593005	413374	1713.41	1938.85	9	0.920859	706	0.529978	1.02621	53.5559	52.4336;
511.087	1	343	688	120.82	105.78	7	0.637274	4461.66	9947.93	2149.76	135.398	188.452	23	0.936457	4053	0.541038	1.87855	79.5819	65.0169;
610.356	6	87	185	232.5	715.5	339.5	0.978679	15597.1	46747.5	16971.4	614.772	1105.38	12	0.864059	2560	0.563797	1.42595	65.342	49.1067;
426.754	5	61	131	233.31	299.61	127.1	0.460326	5821.4	7299.01	866.528	709.551	973.303	12	0.857727	1545	0.571631	1.7569	86.5934	74.4265;
1318.45	3	10	25	180.33	358.36	18.21	1.66526	919.181	4545.29	1860.69	281.217	321.105	5	0.924074	384	0.607576	1.6242	58.3224	58.6855;
1976.34	5	20	49	274.84	331.6	33.18	2.05835	2304.9	14270.3	7083.65	259.407	299.921	5	0.940103	838	0.48866	1.8121	41.7379	39.2421;
0	0	11	23	107.04	138.65	49.87	1.72494	616.9	3477.05	1913.47	111.32	161.599	5	0.874726	225	0.430303	1.32709	83.3988	69.9301;
];
%附录C中样本数据的期望分类
C_T=[
    0 0 1;
    0 1 0;
    0 1 1;
    1 0 0;
    1 0 1;
    1 1 0;
    1 1 1;
];
%对BP神经网络训练测试数据(从题中所给网站下载)
%分别是
other_test=[
6240.75	11 198 417 2874.7 2171.75 3047.89 2.18789 108966 662513 395906 2998.05 3314.91 3.22149 0.997667 1528 0.461351 3.5425 26.8118 27.6281;
7924.85 11 321 663 2441.82 2835.5 3021.36 2.07187 178469 1054610 575718 2439.23 2705.55 2.94237 0.997766 2558 0.483889 3.225 26.5726 27.7165;
716.644 1 1356 2714 108.803 0 110.988 1.00797 12242.8 41925.6 14100.5 123.491 151.514 53 0.984 18192 0.561263 3.90189 67.9606 67;
1524.65 1 592 1186 88.8131 0 96.2924 1.00182 5465.84 19151.5 7249.06 116.86 142.513 48 0.983166 8131 0.548194 3.61062 68.4358 68.3141;
];

%网络训练输入和期望输出
P=[A;C]';
T=[A_T;C_T]';

%对训练样本标准化和主分量化，0.05来源于对样本进行主分量分析所得
[ppca,meanp,stdp]=prestd(P);
[ptrans,transMat]=prepca(ppca,0.05);

%对测试样本进行标准化和主分量化
O=other_test';
on=trastd(O,meanp,stdp);
ontrans=trapca(on,transMat);

%测试样本的期望输出和实际输出
Expect=[0 0 1;0 0 1;0 1 0;0 1 0]';
R=[0 0 0;0 0 0;0 0 0; 0 0 0]';

%训练网络并测试，直到网络能够达到正确分类测试样本
%正确分离测试样本标志着网络训练达到要求
while(sum(sum(abs(Expect-R)>0.5))~=0)
    net=newff(minmax(ptrans),[9 3],{'tansig' 'logsig'},'trainlm');
    net.trainParam.goal=1e-5;
    net.trainParam.epochs=2000;
    net=init(net);
    net=train(net,ptrans,T);
    R=sim(net,ontrans);
end;
R